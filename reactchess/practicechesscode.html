      // Move the piece
      newGame[toRow][toCol] = randomMove.piece;
      newGame[fromRow][fromCol] = '';

      // Check for checkmate condition
      const whiteKingPos = findKing(newGame, 'K');
      if (isKingInCheck(newGame, whiteKingPos, true)) {
        setGameOver(true);
        alert('Game Over! Black wins by checkmating White.');
      }

      setGame(newGame);
      setIsWhiteTurn(true); // Switch back to white's turn
      announceTurn("White"); // Announce white's turn
    }
  }

  // Check if the piece belongs to the player
  function isPlayerPiece(piece, isWhite) {
    return (isWhite && piece === piece.toUpperCase()) || (!isWhite && piece === piece.toLowerCase());
  }

  // Check if the piece is an opponent's piece
  function isOpponentPiece(selectedPiece, targetPiece) {
    return (selectedPiece === selectedPiece.toUpperCase() && targetPiece === targetPiece.toLowerCase()) ||
           (selectedPiece === selectedPiece.toLowerCase() && targetPiece === targetPiece.toUpperCase());
  }

  // Validate if the move is legal
  function isValidMove(piece, fromRow, fromCol, toRow, toCol, newGame) {
    // Add basic validation for different pieces (simplified for demonstration)
    const targetPiece = newGame[toRow][toCol];
    const direction = isUpperCase(piece) ? 1 : -1;

    if (piece.toLowerCase() === 'p') { // Pawn
      const moveForward = (fromRow + direction === toRow && fromCol === toCol);
      const moveCapture = (fromRow + direction === toRow && Math.abs(fromCol - toCol) === 1 && targetPiece !== '');
      return moveForward || moveCapture;
    }

    // Add validation for other pieces (Rook, Knight, Bishop, Queen, King)
    // For now, we'll just allow simple horizontal/vertical movement for rooks
    if (piece.toLowerCase() === 'r') { // Rook
      const sameRow = fromRow === toRow;
      const sameCol = fromCol === toCol;
      const pathClear = isPathClear(fromRow, fromCol, toRow, toCol, newGame);
      return (sameRow || sameCol) && pathClear;
    }

    // For simplicity, assume other pieces cannot move for now
    return false;
  }

  // Check if a given path is clear for rook movement
  function isPathClear(fromRow, fromCol, toRow, toCol, newGame) {
    const rowStep = fromRow === toRow ? 0 : (toRow > fromRow ? 1 : -1);
    const colStep = fromCol === toCol ? 0 : (toCol > fromCol ? 1 : -1);

    let currentRow = fromRow + rowStep;
    let currentCol = fromCol + colStep;

    while (currentRow !== toRow || currentCol !== toCol) {
      if (newGame[currentRow][currentCol] !== '') return false;
      currentRow += rowStep;
      currentCol += colStep;
    }
    return true;
  }

  // Check if the king of the current player is in check
  function isKingInCheck(game, kingPosition, isWhite) {
    const kingPiece = isWhite ? 'K' : 'k';

    // Check all opponent's pieces for attacking moves
    for (let row = 0; row < game.length; row++) {
      for (let col = 0; col < game[row].length; col++) {
        const piece = game[row][col];
        if (piece && isOpponentPiece(piece, kingPiece)) {
          if (isValidMove(piece, row, col, kingPosition[0], kingPosition[1], game)) {
            return true;
          }
        }
      }
    }
    return false;
  }

  // Find the position of the king for the given color
  function findKing(game, kingPiece) {
    for (let row = 0; row < game.length; row++) {
      for (let col = 0; col < game[row].length; col++) {
        if (game[row][col] === kingPiece) {
          return [row, col];
        }
      }
    }
    return null;
  }

  function isUpperCase(character) {
    return character === character.toUpperCase();
  }

  return (
    <div>
      <div className="turn-info">
        {gameOver ? "Game Over" : `${isWhiteTurn ? "White" : "Black"}'s Turn`}
      </div>
      <div className="button-container">
        <button onClick={startRestartGame}>Start/Restart Game</button>
        <button onClick={toggleTTS}>{isTTSEnabled ? 'Disable TTS' : 'Enable TTS'}</button>
      </div>
      <div className="board-container">
        <table>
          <tbody>
            {game.map((row, rowIndex) => (
              <tr key={rowIndex}>
                {row.map((piece, colIndex) => (
                  <td 
                    key={colIndex} 
                    onClick={() => handleClick(rowIndex, colIndex)} 
                    style={{ 
                      width: '60px', 
                      height: '60px', 
                      backgroundColor: (rowIndex + colIndex) % 2 === 0 ? '#eee' : '#777',
                      textAlign: 'center',
                      verticalAlign: 'middle',
                      cursor: 'pointer'
                    }}
                  >
                    {piece && <img src={pieceImages[piece]} alt={piece} style={{ width: '50px', height: '50px' }} />}
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

ReactDOM.render(<Game />, document.getElementById('root'));
